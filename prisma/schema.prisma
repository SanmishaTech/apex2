generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// Approval status for Indents: two-step approval and completion


model User {
  id                        Int                @id @default(autoincrement())
  name                      String?
  email                     String             @unique
  passwordHash              String // was: password
  profilePhoto              String?
  emailVerified             DateTime?
  verificationToken         String?            @unique
  verificationTokenExpiry   DateTime?
  status                    Boolean            @default(true)
  lastLogin                 DateTime?
  createdAt                 DateTime           @default(now())
  updatedAt                 DateTime           @updatedAt
  refreshTokens             RefreshToken[]
  employee                  Employee?
  approvedAssetTransfers    AssetTransfer[]
  approvedManpowerTransfers ManpowerTransfer[] @relation("ManpowerTransferApprovals")
  dailyProgressesCreated    DailyProgress[]    @relation("DailyProgressCreated")
  dailyProgressesUpdated    DailyProgress[]    @relation("DailyProgressUpdated")
  // Back-relations for Indent approval workflow
  indentsApproved1          Indent[]           @relation("IndentApproved1By")
  indentsApproved2          Indent[]           @relation("IndentApproved2By")
  indentsCompleted          Indent[]           @relation("IndentCompletedBy")
  // Back-relation for Indent.suspendedBy
  indentsSuspended          Indent[]           @relation("IndentSuspendedBy")
  // Back-relations for CashbookBudget approval workflow
  cashbookBudgetsApproved   CashbookBudget[]   @relation("CashbookBudgetApproved")
  cashbookBudgetsApproved1  CashbookBudget[]   @relation("CashbookBudgetApproved1")
  cashbookBudgetsAccepted   CashbookBudget[]   @relation("CashbookBudgetAccepted")

  siteEmployeesAssigned             SiteEmployee[]    @relation("siteAssignedBy")

  siteEmployeesAssignedLogs          SiteEmployeeLog[]  @relation("siteAssignedByLogs")
  siteEmployeesUnassignedLogs SiteEmployeeLog[] @relation("siteUnassignedByLogs")

  indentCreated Indent[] @relation("IndentCreated")
  indentUpdated Indent[] @relation("IndentUpdated")

  purchaseOrdersCreated PurchaseOrder[] @relation("POCreated")
  purchaseOrdersUpdated PurchaseOrder[] @relation("POUpdated")
  purchaseOrdersApproved1 PurchaseOrder[] @relation("POApproved1By")
  purchaseOrdersApproved2 PurchaseOrder[] @relation("POApproved2By")
  purchaseOrdersCompleted PurchaseOrder[] @relation("POCompletedBy")
  purchaseOrdersSuspended PurchaseOrder[] @relation("POSuspendedBy")

  workOrdersCreated WorkOrder[] @relation("WOCreated")
  workOrdersUpdated WorkOrder[] @relation("WOUpdated")
  workOrdersApproved1 WorkOrder[] @relation("WOApproved1By")
  workOrdersApproved2 WorkOrder[] @relation("WOApproved2By")
  workOrdersCompleted WorkOrder[] @relation("WOCompletedBy")
  workOrdersSuspended WorkOrder[] @relation("WOSuspendedBy")


  inwardDeliveryChallansCreated InwardDeliveryChallan[] @relation("IDCCreated")
  inwardDeliveryChallansUpdated InwardDeliveryChallan[] @relation("IDCUpdated")


  outwardDeliveryChallanCreated OutwardDeliveryChallan[] @relation("ODCCreated")
  outwardDeliveryChallanUpdated OutwardDeliveryChallan[] @relation("ODCUpdated")
  outwardDeliveryChallanApproved1By OutwardDeliveryChallan[] @relation("ODCApproved1By")
  outwardDeliveryChallanAcceptedBy OutwardDeliveryChallan[] @relation("ODCAcceptedBy")

  dailyConsumptionCreated DailyConsumption[] @relation("ConsumptionCreated")
  dailyConsumptionUpdated DailyConsumption[] @relation("ConsumptionUpdated")

  stockAdjustmentsCreated StockAdjustment[] @relation("SACreated")
  stockAdjustmentsUpdated StockAdjustment[] @relation("SAUpdated")

  boqBillCreated BOQBill[] @relation("BOQBillCreated")
  boqBillUpdated BOQBill[] @relation("BOQBillUpdated")

  boqTargetCreated BoqTarget[] @relation("BOQTargetCreated")
  boqTargetUpdated BoqTarget[] @relation("BOQTargetUpdated")

  siteBudgetCreated SiteBudget[] @relation("SiteBudgetCreated")
  siteBudgetUpdated SiteBudget[] @relation("SiteBudgetUpdated")

  cashbookCreated Cashbook[] @relation("CashbookCreated")
  cashbookUpdated Cashbook[] @relation("CashbookUpdated")
  cashbookApproved1 Cashbook[] @relation("CashbookApproved1By")
  cashbookApproved2 Cashbook[] @relation("CashbookApproved2By")
  
  userRoles UserRole[]
  userPermissions UserPermission[]

  siteManpowerAssigned             SiteManpower[]    @relation("SiteManpowerAssigned")

siteManpowerAssignedLogs          SiteManpowerLog[]  @relation("siteManpowerAssignedByLogs")
siteManpowerUnassignedLogs SiteManpowerLog[] @relation("siteManpowerUnassignedByLogs")
  

  @@map("users")
}

model RefreshToken {
  id         Int       @id @default(autoincrement())
  token      String    @unique
  userId     Int
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt  DateTime
  createdAt  DateTime  @default(now())
  revokedAt  DateTime?
  replacedBy String?

  @@index([userId])
  @@index([expiresAt])
  @@map("refresh_tokens")
}


model Role {
  id          Int      @id @default(autoincrement())
  name        String  @unique
  description String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  users       UserRole[]
  permissions RolePermission[]

  @@index([id])
  @@map("roles")
}

model Permission {
  id          Int      @id @default(autoincrement())
  permissionName         String   @unique
  description String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  roles       RolePermission[]
  users       UserPermission[]

  @@index([permissionName])
  @@index([id])
  @@map("permissions")
}

model RolePermission {
  id           Int @id @default(autoincrement())
  roleId       Int
  permissionId Int

  role       Role       @relation(fields: [roleId], references: [id], onDelete: Restrict)
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Restrict)

  @@unique([roleId, permissionId])
  @@index([roleId])
  @@index([permissionId])
  @@map("role_permissions")
}

model UserRole {
  id     Int @id @default(autoincrement())
  userId Int
  roleId Int

  user User @relation(fields: [userId], references: [id], onDelete: Restrict)
  role Role @relation(fields: [roleId], references: [id], onDelete: Restrict)

  @@unique([userId]) // âœ… only ONE role per user/employee
  @@index([roleId])
  @@map("user_roles")
}

model UserPermission {
  id           Int @id @default(autoincrement())
  userId       Int
  permissionId Int

  user       User       @relation(fields: [userId], references: [id], onDelete: Restrict)
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Restrict)

  @@unique([userId, permissionId]) // prevent duplicates
  @@index([userId])
  @@index([permissionId])
  @@map("user_permissions")
}

model City {
  id        Int      @id @default(autoincrement())
  city      String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  stateId          Int
  state            State           @relation(fields: [stateId], references: [id], onDelete: Restrict)
  companies        Company[]
  sites            Site[]
  employees        Employee[]
  billingAddresses BillingAddress[]
  vendors          Vendor[]
  siteDeliveryAddresses SiteDeliveryAddress[]

  @@map("cities")
}

// Company master data for business management
model Company {
  id          Int     @id @default(autoincrement())
  companyName String
  shortName   String?

  // Contact Person Details
  contactPerson String?
  contactNo     String?

  // Address Details
  addressLine1 String?
  addressLine2 String?
  stateId      Int?
  cityId       Int?
  pinCode      String?

  // Logo
  logoUrl String?

  // Status
  closed Boolean @default(false)

  // Other Details
  panNo String?
  gstNo String?
  tanNo String?
  cinNo String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  state State? @relation(fields: [stateId], references: [id])
  city  City?  @relation(fields: [cityId], references: [id])
  sites Site[]
  companyDocuments CompanyDocument[]

  @@index([companyName])
  @@index([shortName])
  @@index([closed])
  @@index([stateId])
  @@index([cityId])
  @@map("companies")
}

enum SiteStatus {
  ONGOING
  HOLD
  CLOSED
  COMPLETED
  MOBILIZATION_STAGE
}

// Site master data for location/branch management
model Site {
  id        Int     @id @default(autoincrement())
  siteCode     String?  @unique
  site      String  @unique
  shortName String?

  // Company Relation
  companyId Int?
  company   Company? @relation(fields: [companyId], references: [id])

  zoneId    Int?
  zone      Zone?    @relation(fields: [zoneId], references: [id])

  // Status Flags
  status          SiteStatus  //Ongoing,Hold,Closed,Completed,Mobilization stage

  // File Upload
  attachCopyUrl String?
  startDate    DateTime? @db.Date()
  endDate      DateTime? @db.Date()
  completionPeriodInMonths Int?
  extension1EndDate DateTime? @db.Date()
  extension2EndDate DateTime? @db.Date()


  // Address Details
  addressLine1 String?
  addressLine2 String?
  stateId      Int?
  cityId       Int?
  pinCode      String?
  longitude    String?
  latitude     String?

  // Other Details
  panNo String?
  gstNo String?
  tanNo String?
  cinNo String?

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  state              State?      @relation(fields: [stateId], references: [id])
  city               City?       @relation(fields: [cityId], references: [id])
  // Back-relation for Employee.reportingSite
  reportingEmployees Employee[]  @relation("ReportingSite")
  // Back-relation for Boq.site
  boqs               Boq[]
  // Back-relation for BoqTarget.site
  boqTargets         BoqTarget[]
  // Back-relation for CashbookBudget.site
  cashbookBudgets    CashbookBudget[]

  // Back-relation for MinimumWage.site
  minimumWages MinimumWage[]
  // Back-relation for Indent.site
  indents         Indent[]
    workOrders WorkOrder[]


  siteBudgets           SiteBudget[]
  // Back-relation for Rent.site
  rents                 Rent[]
  // Back-relation for Cashbook.site
  cashbooks             Cashbook[]
  // Back-relation for Asset.currentSite
  assets                Asset[]
  assetTransfersFrom    AssetTransfer[]    @relation("FromSiteTransfers")
  assetTransfersTo      AssetTransfer[]    @relation("ToSiteTransfers")
  manpowerTransfersFrom ManpowerTransfer[] @relation("FromSiteManpowerTransfers")
  manpowerTransfersTo   ManpowerTransfer[] @relation("ToSiteManpowerTransfers")
  attendances           Attendance[]       @relation("SiteAttendances")
  paySlipDetails        PaySlipDetail[]
  dailyProgresses       DailyProgress[]
  siteEmployees        SiteEmployee[]
  siteEmployeeLogs     SiteEmployeeLog[]
  siteContactPersons   SiteContactPerson[]
  siteDeliveryAddresses SiteDeliveryAddress[]
  purchaseOrders PurchaseOrder[]
  inwardDeliveryChallans InwardDeliveryChallan[]
  stockLedgers StockLedger[]
  siteItems SiteItem[]

  outwardDeliveryFromSite OutwardDeliveryChallan[] @relation("ODCFromSite")
  outwardDeliveryChallanToSite OutwardDeliveryChallan[] @relation("ODCToSite")

  DailyConsumptions DailyConsumption[]

  stockAdjustments  StockAdjustment[]
  siteManpowers     SiteManpower[]
  siteManpowerLogs SiteManpowerLog[]
  siteItemBatches  SiteItemBatch[]



  @@index([site])
  @@index([shortName])
  @@index([siteCode])
  @@index([companyId])
  @@index([stateId])
  @@index([cityId])
    @@index([zoneId])

  @@map("sites")
}

// Department master data (single-field entity)
model Department {
  id         Int      @id @default(autoincrement())
  department String   @unique
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  employees Employee[]

  @@index([department])
  @@map("departments")
}

// Rent Type master data (single-field entity)
model RentType {
  id        Int      @id @default(autoincrement())
  rentType  String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  rents Rent[]

  @@index([rentType])
  @@map("rent_types")
}

// Employee master data for workforce management
model Employee {
  id   Int    @id @default(autoincrement())
  employeeNumber String @unique
  name String
  designationId Int?
  designation Designation? @relation(fields: [designationId], references: [id], onDelete:Restrict)
  previousWorkExperience String?
  emergencyContactPerson String?
  emergencyContactNo String?
  emergencyContactRelation String?
  joinDate DateTime?
  // User Relation (each employee is linked to a user account)
  userId Int?  @unique
  user   User? @relation(fields: [userId], references: [id])

  // Department Relation
  departmentId Int?
  department   Department? @relation(fields: [departmentId], references: [id], onDelete:Restrict)

  // Reporting Site
  reportingSiteId           Int?
  reportingSite             Site?     @relation("ReportingSite", fields: [reportingSiteId], references: [id])
  reportingSiteAssignedDate DateTime?

  // Employment Details
  resignDate DateTime?

  // Personal Details
  dateOfBirth     DateTime?
  anniversaryDate DateTime?
  spouseName      String?
  bloodGroup      String?

  // Address Details
  correspondenceAddress String?
  permanentAddress String?
  stateId      Int?
  state        State?  @relation(fields: [stateId], references: [id])
  cityId       Int?
  city         City?   @relation(fields: [cityId], references: [id])
  pincode      String?

  // Contact Details
  mobile1 String?
  mobile2 String?

  // Other Details
  esic    String?
  pf      String?
  panNo   String?
  adharNo String?
  cinNo   String?

  // Travel/Reporting Details
  airTravelClass     String?
  railwayTravelClass String?
  busTravelClass     String?
  reporting1Id       Int?
  reporting2Id       Int?
  reporting1         Employee?  @relation("EmployeeReporting1", fields: [reporting1Id], references: [id])
  reporting2         Employee?  @relation("EmployeeReporting2", fields: [reporting2Id], references: [id])
  subordinates1      Employee[] @relation("EmployeeReporting1")
  subordinates2      Employee[] @relation("EmployeeReporting2")
  siteEmployees      SiteEmployee[]
  siteEmployeesLogs  SiteEmployeeLog[]
  employeeDocuments  EmployeeDocument[]

  // Leave Details
  sickLeavesPerYear   Int?
  paidLeavesPerYear   Int?
  casualLeavesPerYear Int?
  balanceSickLeaves   Int?
  balancePaidLeaves   Int?
  balanceCasualLeaves Int?

  employeeImage String?  @db.LongText 
  signatureImage String?  @db.LongText  

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([name])
  @@index([departmentId])
  @@index([resignDate])
  @@index([stateId])
  @@index([cityId])
  @@index([dateOfBirth])
  @@index([reporting1Id])
  @@index([reporting2Id])
  @@index([reportingSiteId])
  @@map("employees")
}

// Category master data
model Category {
  id           Int      @id @default(autoincrement())
  categoryName String   @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Back-relation for MinimumWage.category
  minimumWages MinimumWage[]
  siteManpowers SiteManpower[]


  @@index([categoryName])
  @@map("categories")
}

// Rental Category master data
model RentalCategory {
  id             Int      @id @default(autoincrement())
  rentalCategory String   @unique
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  rents Rent[]

  @@index([rentalCategory])
  @@map("rental_categories")
}

// Skill Set master data
model SkillSet {
  id           Int      @id @default(autoincrement())
  skillsetName String   @unique
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Back-relation for MinimumWage.skillSet
  minimumWages MinimumWage[]
  siteManpowers SiteManpower[]

  @@index([skillsetName])
  @@map("skill_sets")
}

// State master data
model State {
  id        Int      @id @default(autoincrement())
  state     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  cities           City[]
  companies        Company[]
  sites            Site[]
  employees        Employee[]
  billingAddresses BillingAddress[]
  vendors          Vendor[]
  siteDeliveryAddresses SiteDeliveryAddress[]

  @@map("states")
}


model Designation {
  id        Int      @id @default(autoincrement())
  designationName     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
 
  employees        Employee[]
  
  @@map("designations")
}

// Unit master data
model Unit {
  id        Int      @id @default(autoincrement())
  unitName  String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  boqItems    BoqItem[]
  items       Item[]

  @@map("units")
}

// Asset Group master data
model AssetGroup {
  id             Int      @id @default(autoincrement())
  assetGroupName String   @unique
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  // Relations
  assetCategories AssetCategory[]
  assets          Asset[]

  @@map("asset_groups")
}

// Asset Category master data
model AssetCategory {
  id           Int      @id @default(autoincrement())
  assetGroupId Int
  category     String
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  // Relations
  assetGroup AssetGroup @relation(fields: [assetGroupId], references: [id], onDelete: Restrict)
  assets     Asset[]

  @@unique([assetGroupId, category]) // Unique category per asset group
  @@index([assetGroupId])
  @@map("asset_categories")
}

// Asset master data for asset management
model Asset {
  id      Int    @id @default(autoincrement())
  assetNo String @unique // auto-generated like AST-00001

  // Asset Details
  assetGroupId    Int
  assetCategoryId Int
  assetName       String
  make            String?
  description     String? @db.Text

  // Purchase Details
  purchaseDate        DateTime?
  invoiceNo           String?
  supplier            String?
  invoiceCopyUrl      String? // Invoice copy file path
  nextMaintenanceDate DateTime?
  status              String    @default("Working") // Working, Under Repair, etc.
  useStatus           String    @default("In Use") // In Use, Available, etc.
  transferStatus      String    @default("Available") // Available, In Transit, Assigned
  currentSiteId       Int? // Current site where asset is located
  currentSite         Site?     @relation(fields: [currentSiteId], references: [id])

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  assetGroup    AssetGroup          @relation(fields: [assetGroupId], references: [id])
  assetCategory AssetCategory       @relation(fields: [assetCategoryId], references: [id])
  transferItems AssetTransferItem[]
  assetDocuments AssetDocument[]

  @@index([assetNo])
  @@index([assetGroupId])
  @@index([assetCategoryId])
  @@index([assetName])
  @@index([status])
  @@index([useStatus])
  @@index([transferStatus])
  @@index([currentSiteId])
  @@index([purchaseDate])
  @@map("assets")
}

// Item Category master data
model ItemCategory {
  id               Int      @id @default(autoincrement())
  itemCategoryCode String   @unique
  itemCategory     String
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  items            Item[]
  vendorCategories VendorItemCategory[]

  @@map("item_categories")
}

// Items master data
model Item {
  id             Int           @id @default(autoincrement())
  itemCode       String        @unique // auto-generated
  hsnCode        String?
  item           String          
  itemCategoryId Int?
  itemCategory   ItemCategory? @relation(fields: [itemCategoryId], references: [id])
  unitId         Int?
  unit           Unit?         @relation(fields: [unitId], references: [id])
  gstRate        Decimal?      @db.Decimal(5, 2)
  asset          Boolean       @default(false)
  isExpiryDate   Boolean       @default(false)
  discontinue    Boolean       @default(false)
  description    String?       @db.Text
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  // Relations
  indentItems IndentItem[]

    purchaseOrderDetails PurchaseOrderDetail[] 
   workOrderDetails WorkOrderDetail[]
   stockLedgers StockLedger[]
   siteItems    SiteItem[]
   outwardDeliveryChallanDetails  OutwardDeliveryChallanDetail[]
    dailyConsumptionDetails DailyConsumptionDetail[]
    stockAdjustmentDetail   StockAdjustmentDetail[]
    siteBudgetItems SiteBudgetItem[]
    siteItemBatches  SiteItemBatch[]

  @@index([itemCode])
  @@index([itemCategoryId])
  @@index([unitId])
  @@map("items")
}

// Billing Address master data
model BillingAddress {
  id           Int      @id @default(autoincrement())
  companyName  String
  addressLine1 String
  addressLine2 String?
  stateId      Int?
  state        State?   @relation(fields: [stateId], references: [id])
  cityId       Int?
  city         City?    @relation(fields: [cityId], references: [id])
  pincode      String?
  landline1    String?
  landline2    String?
  fax          String?
  email        String?
  panNumber    String?
  vatTinNumber String?
  gstNumber    String?
  cstTinNumber String?
  cinNumber    String?
  stateCode    String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

   purchaseOrders PurchaseOrder[]
    workOrders WorkOrder[]

  @@index([companyName])
  @@map("billing_addresses")
}

// Vendor master data
model Vendor {
  id               Int                  @id @default(autoincrement())
  vendorName       String
  contactPerson    String?
  addressLine1     String
  addressLine2     String?
  stateId          Int?
  state            State?               @relation(fields: [stateId], references: [id])
  cityId           Int?
  city             City?                @relation(fields: [cityId], references: [id])
  pincode          String?
  mobile1          String?
  mobile2          String?
  email            String?
  alternateEmail1  String?
  alternateEmail2  String?
  alternateEmail3  String?
  alternateEmail4  String?
  landline1        String?
  landline2        String?
  bank             String?
  branch           String?
  branchCode       String?
  accountNumber    String?
  ifscCode         String?
  panNumber        String?
  vatTinNumber     String?
  cstTinNumber     String?
  gstNumber        String?
  cinNumber        String?
  serviceTaxNumber  String?
  stateCode        String?
  itemCategories   VendorItemCategory[]
  bankAccounts     VendorBankAccount[]
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt

  purchaseOrders PurchaseOrder[]
    workOrders WorkOrder[]
    inwardDeliveryChallans InwardDeliveryChallan[]

  @@index([vendorName])
  @@index([email])
  @@index([gstNumber])
  @@index([stateId])
  @@index([cityId])
  @@map("vendors")
}

// Junction table for Vendor-ItemCategory many-to-many relationship
model VendorItemCategory {
  id             Int          @id @default(autoincrement())
  vendorId       Int
  itemCategoryId Int
  vendor         Vendor       @relation(fields: [vendorId], references: [id], onDelete: Restrict)
  itemCategory   ItemCategory @relation(fields: [itemCategoryId], references: [id], onDelete: Restrict)
  createdAt      DateTime     @default(now())

  @@unique([vendorId, itemCategoryId])
  @@index([vendorId])
  @@index([itemCategoryId])
  @@map("vendor_item_categories")
}

// Vendor Bank Accounts (multiple bank accounts per vendor, max 3)
model VendorBankAccount {
  id            Int      @id @default(autoincrement())
  vendorId      Int
  vendor        Vendor   @relation(fields: [vendorId], references: [id], onDelete: Restrict)
  bank          String?
  branch        String?
  branchCode    String?
  accountNumber String?
  ifscCode      String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([vendorId])
  @@map("vendor_bank_accounts")
}

// Bill of Quantity (BOQ)
model Boq {
  id                            Int         @id @default(autoincrement())
  boqNo                         String?     @unique // auto-generated like BOQ-00001
  siteId                        Int?
  site                          Site?       @relation(fields: [siteId], references: [id])
  workName                      String? @db.Text
  workOrderNo                   String?
  workOrderDate                 DateTime?
  startDate                     DateTime?
  endDate                       DateTime?
  totalWorkValue                Decimal?    @db.Decimal(12, 2)
  gstRate                       Decimal?    @db.Decimal(5, 2)
  agreementNo                   String?
  agreementStatus               String?
  completionPeriod              String?
  completionDate                DateTime?
  dateOfExpiry                  DateTime?
  commencementDate              DateTime?
  timeExtensionDate             DateTime?
  defectLiabilityPeriod         String?
  performanceSecurityMode       String?
  performanceSecurityDocumentNo String?
  performanceSecurityPeriod     String?
  createdAt                     DateTime    @default(now())
  updatedAt                     DateTime    @updatedAt
  // Relations
  items                         BoqItem[]
  targets                       BoqTarget[]
  // Back-relation for Rent.boq
  rents                         Rent[]
  // Back-relation for Cashbook.boq
  cashbooks                     Cashbook[]
  // Back-relation for CashbookBudget.boq
  cashbookBudgets               CashbookBudget[]
  // Back-relation for PurchaseOrder.boq
  // daily progress
  dailyProgresses               DailyProgress[]
  boqBills BOQBill[]
  siteBudgets SiteBudget[]


  @@index([siteId])
  @@index([boqNo])
  @@map("boqs")
}

// BOQ line items
model BoqItem {
  id           Int      @id @default(autoincrement())
  boqId        Int
  boq          Boq      @relation(fields: [boqId], references: [id], onDelete: Restrict)
  activityId   String
  clientSrNo   String
  item         String  @db.Text// long description
  unitId       Int?
  unit         Unit?    @relation(fields: [unitId], references: [id])
  qty          Decimal @db.Decimal(12, 2)   @default(0.00)
  rate         Decimal @db.Decimal(12, 2)@default(0.00)
  amount       Decimal @db.Decimal(14, 2) @default(0.00)
  orderedQty   Decimal @db.Decimal(12, 2) @default(0.00)
  orderedValue Decimal @db.Decimal(12, 2) @default(0.00)
  remainingQty   Decimal @db.Decimal(12, 2) @default(0.00)
  remainingValue Decimal @db.Decimal(12, 2) @default(0.00)
  isGroup      Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  dailyProgressDetails DailyProgressDetail[]
  boqBillDetails BOQBillDetail[]
  boqTargetDetails  BoqTargetDetail[]
  siteBudgetDetails SiteBudgetDetail[]

  @@index([boqId])
  @@index([unitId])
  @@map("boq_items")
}

// BOQ Targets for daily quantity planning
model BoqTarget {
  id             Int      @id @default(autoincrement())
  siteId         Int
  site           Site     @relation(fields: [siteId], references: [id], onDelete: Restrict)
  boqId          Int
  boq            Boq      @relation(fields: [boqId], references: [id], onDelete: Restrict)
  month          String
  week           String
  fromTargetDate DateTime  @db.Date()
  toTargetDate   DateTime   @db.Date()
  createdById      Int
  updatedById      Int
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  boqTargetDetails  BoqTargetDetail[]
  createdBy User @relation("BOQTargetCreated", fields: [createdById], references: [id], onDelete: Restrict)
  updatedBy User @relation("BOQTargetUpdated", fields: [updatedById], references: [id], onDelete: Restrict)

  @@index([createdById])
  @@index([updatedById])
  @@index([siteId])
  @@index([boqId])
  @@index([fromTargetDate])
  @@index([toTargetDate])
  @@index([month])
  @@index([week])
  @@unique([siteId, boqId, month, week])

  @@map("boq_targets")
}

model BoqTargetDetail {
  id             Int      @id @default(autoincrement())
  boqTargetId          Int
  boqTarget            BoqTarget      @relation(fields: [boqTargetId], references: [id], onDelete: Restrict)
  BoqItemId     Int 
  boqItem            BoqItem      @relation(fields: [BoqItemId], references: [id], onDelete: Restrict)
  totalMonthQty  Decimal @db.Decimal(12, 2)
  dailyTargetQty  Decimal?  @db.Decimal(12, 2)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([boqTargetId])
  @@index([BoqItemId])
  @@map("boq_target_details")
}

// Notice announcements with optional document upload
model Notice {
  id                Int      @id @default(autoincrement())
  noticeHead        String
  noticeHeading     String
  noticeDescription String?
  documentUrl       String? // path under /uploads/notices
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  noticeDocuments NoticeDocument[]

  @@index([createdAt])
  @@map("notices")
}

// Manpower Supplier master data
model ManpowerSupplier {
  id                 Int      @id @default(autoincrement())
  vendorCode         String   @unique // Auto-generated, required
  supplierName       String // "Manpower Supplier"
  contactPerson      String?
  representativeName String?
  localContactNo     String?
  permanentContactNo String?
  address            String?  @db.Text
  state              String?
  permanentAddress   String?  @db.Text
  city               String?
  pincode            String?
  bankName           String?
  accountNo          String?
  ifscNo             String?
  rtgsNo             String?
  panNo              String?
  adharNo            String?
  pfNo               String?
  esicNo             String?
  gstNo              String?
  numberOfWorkers    Int?
  typeOfWork         String?  @db.Text
  workDone           String?  @db.Text
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  // Back-relation: all manpower workers for this supplier
  manpower Manpower[]

  @@index([supplierName])
  @@index([city])
  @@map("manpower_suppliers")
}

// Manpower (individual worker) linked to a ManpowerSupplier
model Manpower {
  id               Int              @id @default(autoincrement())
  firstName        String
  middleName       String?
  lastName         String?
  supplierId       Int
  manpowerSupplier ManpowerSupplier @relation(fields: [supplierId], references: [id])
  dateOfBirth      DateTime?

  // Contact details
  address      String?  @db.Text
  location     String?
  mobileNumber String?

  // Bank details
  bank          String?
  branch        String?
  accountNumber String?
  ifscCode      String?
  pfNo          String?
  esicNo        String?
  unaNo         String?

  // Other details with document URLs stored in /uploads/manpower
  panNumber                 String?
  panDocumentUrl            String?
  aadharNo                  String?
  aadharDocumentUrl         String?
  voterIdNo                 String?
  voterIdDocumentUrl        String?
  drivingLicenceNo          String?
  drivingLicenceDocumentUrl String?
  bankDetailsDocumentUrl    String?
  bankDetails               String?
  watch                     Boolean @default(false)

  // Assignment tracking fields
  
  isAssigned    Boolean   @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  transferItems ManpowerTransferItem[]
  attendances   Attendance[]           @relation("ManpowerAttendances")
  paySlips      PaySlip[]
  manpowerDocuments     ManpowerDocument[]
  siteManpower      SiteManpower?
  siteManpowerLogs SiteManpowerLog[]
  @@index([supplierId])
  @@index([firstName, lastName])
  @@index([isAssigned])
  @@map("manpower")
}
model SiteManpower {
  id           Int      @id @default(autoincrement())
  siteId       Int    
  manpowerId   Int      @unique
  isPresent    Boolean  @default(false)   
  categoryId   Int?
  skillsetId   Int?
  wage         Decimal? @db.Decimal(10, 2) 
  minWage      Decimal? @db.Decimal(10, 2) 
  pf           Boolean  @default(false)
  esic          Boolean  @default(false)
  hra           Boolean  @default(false)
  pt           Boolean  @default(false)
  mlwf         Boolean  @default(false)
  // end
  assignedDate DateTime
  assignedById   Int
 
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  manpower    Manpower @relation(fields: [manpowerId], references: [id],onDelete: Restrict)
  site      Site @relation(fields: [siteId], references: [id], onDelete: Restrict)
  assignedBy User @relation("SiteManpowerAssigned", fields: [assignedById], references: [id], onDelete: Restrict)
  category    Category?   @relation(fields: [categoryId], references: [id], onDelete: Restrict)
  skillset    SkillSet?   @relation(fields: [skillsetId], references: [id], onDelete: Restrict)
  @@index([siteId])
  @@index([categoryId])
  @@index([skillsetId])
  @@index([manpowerId])
  @@index([assignedById])
  // @@index([unassignedById])
  @@map("site_manpowers")
}

model SiteManpowerLog {
  id           Int      @id @default(autoincrement())
  siteId       Int    
  manpowerId   Int     
  assignedDate DateTime
  assignedById   Int
  unassignedDate DateTime?
  unassignedById Int?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  manpower    Manpower @relation(fields: [manpowerId], references: [id], onDelete: Restrict)
  site      Site @relation(fields: [siteId], references: [id], onDelete: Restrict)
  assignedBy User @relation("siteManpowerAssignedByLogs", fields: [assignedById], references: [id], onDelete: Restrict)
  unassignedBy User? @relation("siteManpowerUnassignedByLogs", fields: [unassignedById], references: [id], onDelete: Restrict)


  @@index([siteId])
  @@index([manpowerId])
  @@index([assignedById])
  @@index([unassignedById])
  @@map("site_manpower_logs")
}

// Minimum wage mapping per Site + Category + SkillSet
model MinimumWage {
  id         Int      @id @default(autoincrement())
  siteId     Int
  categoryId Int
  skillSetId Int
  minWage    Decimal  @db.Decimal(12, 2)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  site     Site     @relation(fields: [siteId], references: [id])
  category Category @relation(fields: [categoryId], references: [id])
  skillSet SkillSet @relation(fields: [skillSetId], references: [id])

  @@unique([siteId, categoryId, skillSetId])
  @@index([siteId])
  @@index([categoryId])
  @@index([skillSetId])
  @@map("minimum_wages")
}

// Payment Terms master data
model PaymentTerm {
  id          Int      @id @default(autoincrement())
  paymentTerm String   @unique
  description String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  purchaseOrders PurchaseOrder[]
    workOrders WorkOrder[]
    poPaymentTerms POPaymentTerm[]

  @@index([paymentTerm])
  @@map("payment_terms")
}

model POPaymentTerm {
  id          Int      @id @default(autoincrement())
  purchaseOrderId      Int
  paymentTermId Int  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  purchaseOrder PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete:Restrict)
  paymentTerm PaymentTerm @relation(fields: [paymentTermId], references: [id], onDelete:Restrict)

  @@index([purchaseOrderId])
  @@index([paymentTermId])
  @@unique([purchaseOrderId, paymentTermId])
  @@map("po_payment_terms")
}

// Cashbook Heads master data
model CashbookHead {
  id               Int      @id @default(autoincrement())
  cashbookHeadName String   @unique
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Relations
  cashbookBudgetItems CashbookBudgetItem[]
  cashbookDetails     CashbookDetail[]

  @@index([cashbookHeadName])
  @@map("cashbook_heads")
}

// Cashbook Budgets master data
model CashbookBudget {
  id                      Int      @id @default(autoincrement())
  name                    String
  month                   String  @unique
  siteId                  Int?
  site                    Site?    @relation(fields: [siteId], references: [id])
  boqId                   Int?
  boq                     Boq?     @relation(fields: [boqId], references: [id])
  attachCopyUrl           String?
  approved1Remarks        String?  @db.Text
  remarksForFinalApproval String?  @db.Text
  totalBudget             Decimal  @default(0) @db.Decimal(12, 2) 
  
  // Approval workflow - First approval
  approvedBy              Int?
  approvedBy_user         User?    @relation("CashbookBudgetApproved", fields: [approvedBy], references: [id])
  approvedDatetime        DateTime?
  approvedBudgetAmount    Decimal? @db.Decimal(12, 2) @default(0.00)
  
  // Approval workflow - Second approval
  approved1By             Int?
  approved1By_user        User?    @relation("CashbookBudgetApproved1", fields: [approved1By], references: [id])
  approved1Datetime       DateTime?
  approved1BudgetAmount   Decimal? @db.Decimal(12, 2) @default(0.00)
  
  // Acceptance workflow
  acceptedBy              Int?
  acceptedBy_user         User?    @relation("CashbookBudgetAccepted", fields: [acceptedBy], references: [id])
  acceptedDatetime        DateTime?
  
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt

  // Relations
  budgetItems CashbookBudgetItem[]

  @@unique([month, siteId, boqId])
  @@index([name])
  @@index([month])
  @@index([siteId])
  @@index([boqId])
  @@map("cashbook_budgets")
}

// Cashbook Budget Items (line items for budgets)
model CashbookBudgetItem {
  id              Int            @id @default(autoincrement())
  budgetId        Int
  budget          CashbookBudget @relation(fields: [budgetId], references: [id], onDelete: Cascade)
  cashbookHeadId  Int
  cashbookHead    CashbookHead   @relation(fields: [cashbookHeadId], references: [id])
  description     String?        @db.Text
  amount          Decimal        @db.Decimal(12, 2)
  approvedAmount  Decimal?       @db.Decimal(12, 2)
  approved1Amount Decimal?       @db.Decimal(12, 2)  
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@index([budgetId])
  @@index([cashbookHeadId])
  @@map("cashbook_budget_items")
}




// Rent master data for rental agreement management
model Rent {
  id Int @id @default(autoincrement())

  // Basic Details
  siteId           Int?
  site             Site?           @relation(fields: [siteId], references: [id])
  boqId            Int?
  boq              Boq?            @relation(fields: [boqId], references: [id])
  rentalCategoryId Int?
  rentalCategory   RentalCategory? @relation(fields: [rentalCategoryId], references: [id])
  rentTypeId       Int?
  rentType         RentType?       @relation(fields: [rentTypeId], references: [id])
  owner            String?
  pancardNo        String?
  rentDay          String? // Dropdown: 1st, 2nd, etc.
  fromDate         DateTime?
  toDate           DateTime?
  description      String?
  depositAmount    Decimal?        @db.Decimal(12, 2)
  rentAmount       Decimal?        @db.Decimal(12, 2)

  // Monthly Tracking Fields
  srNo        Int? // Serial number for the month
  listStatus  String? // 'First', 'Last', or null for middle months
  dueDate     DateTime? // Actual due date for this month's rent
  status      String? @default("Unpaid") // 'Paid' or 'Unpaid'

  // Bank Details
  bank        String?
  branch      String?
  accountNo   String?
  accountName String?
  ifscCode    String?

  paymentMethod  String?
  utrNumber  String?
  chequeNumber String?
  chequeDate DateTime?
  bankDetails String?
  paymentDate DateTime?

  // File Upload
  momCopyUrl String? // MOM Copy file path

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  rentDocuments RentDocument[]

  @@index([siteId])
  @@index([boqId])
  @@index([rentalCategoryId])
  @@index([rentTypeId])
  @@index([fromDate])
  @@index([toDate])
  @@index([owner])
  @@index([dueDate])
  @@index([status])
  @@map("rents")
}

// Cashbook voucher master data for voucher management
model Cashbook {
  id Int @id @default(autoincrement())

  // Header Details
  voucherNo            String    @unique // auto-generated like VCH-00001
  voucherDate          DateTime @db.Date()
  siteId               Int?
  site                 Site?    @relation(fields: [siteId], references: [id])
  boqId                Int?
  boq                  Boq?     @relation(fields: [boqId], references: [id])
  attachVoucherCopyUrl String? // File upload for voucher copy


createdById      Int
updatedById      Int


  isApproved1             Boolean  @default(false)
  approved1ById  Int?
  approved1By    User?                @relation("CashbookApproved1By", fields: [approved1ById], references: [id], onDelete: Restrict)
  approved1At    DateTime?
   isApproved2             Boolean  @default(false)
   approved2ById  Int?
  approved2By    User?                @relation("CashbookApproved2By", fields: [approved2ById], references: [id], onDelete: Restrict)
  approved2At    DateTime?
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
createdBy User @relation("CashbookCreated", fields: [createdById], references: [id], onDelete: Restrict)
updatedBy User @relation("CashbookUpdated", fields: [updatedById], references: [id], onDelete: Restrict)
  // Relations
  cashbookDetails CashbookDetail[]

  @@index([voucherNo])
  @@index([siteId])
  @@index([boqId])
  @@index([voucherDate])
  @@map("cashbooks")
}

// Cashbook detail items (line items for cashbook vouchers)
model CashbookDetail {
  id             Int          @id @default(autoincrement())
  cashbookId     Int
  cashbook       Cashbook     @relation(fields: [cashbookId], references: [id], onDelete: Cascade)
  cashbookHeadId Int
  cashbookHead   CashbookHead @relation(fields: [cashbookHeadId], references: [id])
  description    String?      @db.Text
  openingBalance       Decimal?     @db.Decimal(12, 2)
  closingBalance        Decimal?     @db.Decimal(12, 2)
  amountReceived       Decimal?     @db.Decimal(12, 2)
  amountPaid        Decimal?     @db.Decimal(12, 2)
  documentUrl    String?        @db.Text
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt

  @@index([cashbookId])
  @@index([cashbookHeadId])
  @@map("cashbook_details")
}

// Asset Transfer for assigning/transferring assets between sites
model AssetTransfer {
  id             Int       @id @default(autoincrement())
  challanNo      String    @unique // auto-generated like CHN-00001
  challanDate    DateTime
  transferType   String // "New Assign" or "Transfer"
  fromSiteId     Int? // null for new assignments
  fromSite       Site?     @relation("FromSiteTransfers", fields: [fromSiteId], references: [id])
  toSiteId       Int
  toSite         Site      @relation("ToSiteTransfers", fields: [toSiteId], references: [id])
  status         String    @default("Pending") // Pending, Accepted, Rejected
  challanCopyUrl String? // File upload for challan copy
  approvedById   Int? // User who approved/rejected
  approvedBy     User?     @relation(fields: [approvedById], references: [id])
  approvedAt     DateTime?
  remarks        String?   @db.Text
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Relations
  transferItems AssetTransferItem[]
  assetTransferDocuments AssetTransferDocument[]

  @@index([challanNo])
  @@index([fromSiteId])
  @@index([toSiteId])
  @@index([status])
  @@index([transferType])
  @@index([challanDate])
  @@map("asset_transfers")
}

// Junction table for multiple assets per transfer
model AssetTransferItem {
  id              Int      @id @default(autoincrement())
  assetTransferId Int
  assetId         Int
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  assetTransfer AssetTransfer @relation(fields: [assetTransferId], references: [id], onDelete: Restrict)
  asset         Asset         @relation(fields: [assetId], references: [id])

  @@map("asset_transfer_items")
}

// Attendance tracking for manpower per site
model Attendance {
  id         Int      @id @default(autoincrement())
  date       DateTime // Attendance date
  siteId     Int
  site       Site     @relation("SiteAttendances", fields: [siteId], references: [id])
  manpowerId Int
  manpower   Manpower @relation("ManpowerAttendances", fields: [manpowerId], references: [id])
  isPresent  Boolean  @default(false) // Present/Absent
  isIdle     Boolean  @default(false) // Idle status
  ot         Decimal? @db.Decimal(5, 2) // Overtime hours
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([date, siteId, manpowerId]) // One attendance record per manpower per site per date
  @@index([date])
  @@index([siteId])
  @@index([manpowerId])
  @@index([isPresent])
  @@map("attendances")
}

// Manpower Transfer for transferring assigned manpower between sites
model ManpowerTransfer {
  id             Int       @id @default(autoincrement())
  challanNo      String    @unique // auto-generated like MPT-00001
  challanDate    DateTime
  fromSiteId     Int
  fromSite       Site      @relation("FromSiteManpowerTransfers", fields: [fromSiteId], references: [id])
  toSiteId       Int
  toSite         Site      @relation("ToSiteManpowerTransfers", fields: [toSiteId], references: [id])
  status         String    @default("Pending") // Pending, Accepted, Rejected
  approvedById   Int? // User who approved/rejected
  approvedBy     User?     @relation("ManpowerTransferApprovals", fields: [approvedById], references: [id])
  approvedAt     DateTime?
  remarks        String?   @db.Text
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  // Relations
  transferItems ManpowerTransferItem[]

  @@index([challanNo])
  @@index([fromSiteId])
  @@index([toSiteId])
  @@index([status])
  @@index([challanDate])
  @@map("manpower_transfers")
}

// Junction table for multiple manpower per transfer
model ManpowerTransferItem {
  id                 Int      @id @default(autoincrement())
  manpowerTransferId Int
  manpowerId         Int
  // Preserve original assignment details during transfer
  category           String?
  skillSet           String?
  wage               Decimal? @db.Decimal(12, 2)
  minWage            Decimal? @db.Decimal(10, 2)
  hours              Decimal? @db.Decimal(5, 2)
  esic               Decimal? @db.Decimal(10, 2)
  pf                 Boolean  @default(false)
  pt                 Decimal? @db.Decimal(10, 2)
  hra                Decimal? @db.Decimal(10, 2)
  mlwf               Decimal? @db.Decimal(10, 2)
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  manpowerTransfer ManpowerTransfer @relation(fields: [manpowerTransferId], references: [id], onDelete: Restrict)
  manpower         Manpower         @relation(fields: [manpowerId], references: [id])

  @@index([manpowerTransferId])
  @@index([manpowerId])
  @@map("manpower_transfer_items")
}

// Payroll models
model PaySlip {
  id            Int             @id @default(autoincrement())
  manpowerId    Int
  manpower      Manpower        @relation(fields: [manpowerId], references: [id])
  period        String // MM-YYYY
  paySlipDate   DateTime
  govt          Boolean         @default(false)
  netWages      Decimal         @db.Decimal(12, 2)
  amountInWords String?
  details       PaySlipDetail[]
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  @@unique([manpowerId, period, govt])
  @@index([period])
  @@index([govt])
  @@map("pay_slips")
}

model PaySlipDetail {
  id            Int      @id @default(autoincrement())
  paySlipId     Int
  paySlip       PaySlip  @relation(fields: [paySlipId], references: [id], onDelete: Restrict)
  siteId        Int
  site          Site     @relation(fields: [siteId], references: [id])
  workingDays   Decimal  @db.Decimal(6, 2)
  ot            Decimal? @db.Decimal(6, 2)
  idle          Decimal? @db.Decimal(6, 2)
  wages         Decimal  @db.Decimal(12, 2)
  grossWages    Decimal  @db.Decimal(12, 2)
  hra           Decimal? @db.Decimal(12, 2)
  pf            Decimal? @db.Decimal(12, 2)
  esic          Decimal? @db.Decimal(12, 2)
  pt            Decimal? @db.Decimal(12, 2)
  mlwf          Decimal? @db.Decimal(12, 2)
  total         Decimal  @db.Decimal(12, 2)
  amountInWords String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([paySlipId])
  @@index([siteId])
  @@map("pay_slip_details")
}

model PayrollConfig {
  id                Int      @id @default(1)
  hoursPerDay       Decimal  @default(8) @db.Decimal(6, 2)
  govtWorkingDayCap Int      @default(26)
  hraPercentage     Decimal  @default(5.00) @db.Decimal(6, 2)
  pfPercentage      Decimal  @default(12.00) @db.Decimal(6, 2)
  esicPercentage    Decimal  @default(1.75) @db.Decimal(6, 2)
  ptThreshold1      Decimal  @default(7500) @db.Decimal(12, 2)
  ptAmount1         Decimal  @default(175) @db.Decimal(12, 2)
  ptThreshold2      Decimal  @default(10000) @db.Decimal(12, 2)
  ptAmount2         Decimal  @default(200) @db.Decimal(12, 2)
  febPtAmount       Decimal  @default(300) @db.Decimal(12, 2)
  mlwfAmount        Decimal  @default(12) @db.Decimal(12, 2)
  mlwfMonths        String   @default("02,06")
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@map("payroll_config")
}

model DailyProgress {
  id           Int      @id @default(autoincrement())
  siteId       Int
  boqId        Int
  progressDate DateTime
  amount       Decimal  @default(0.00) @db.Decimal(12, 2)
  createdById  Int
  createdAt    DateTime @default(now())
  updatedById  Int
  updatedAt    DateTime @updatedAt

  site      Site @relation(fields: [siteId], references: [id], onDelete: Restrict)
  boq       Boq  @relation(fields: [boqId], references: [id], onDelete: Restrict)
  createdBy User @relation("DailyProgressCreated", fields: [createdById], references: [id], onDelete: Restrict)
  updatedBy User @relation("DailyProgressUpdated", fields: [updatedById], references: [id], onDelete: Restrict)

  dailyProgressHindrances DailyProgressHindrance[]
  dailyProgressDetails    DailyProgressDetail[]

  @@index([siteId])
  @@index([boqId])
  @@index([createdById])
  @@index([updatedById])
  @@map("daily_progresses")
}

model DailyProgressDetail {
  id              Int     @id @default(autoincrement())
  dailyProgressId Int
  boqItemId       Int
  clientSerialNo  String?
  activityId      String?
  particulars     String?
  doneQty         Decimal @default(0.00) @db.Decimal(12, 2)
  amount          Decimal @default(0.00) @db.Decimal(12, 2)

  // Relations
  dailyProgress DailyProgress @relation(fields: [dailyProgressId], references: [id], onDelete: Restrict)
  boqItems      BoqItem       @relation(fields: [boqItemId], references: [id], onDelete: Restrict)

  @@index([dailyProgressId])
  @@index([boqItemId])
  @@map("daily_progress_details")
}

model DailyProgressHindrance {
  id              Int       @id @default(autoincrement())
  dailyProgressId Int
  from            DateTime?
  to              DateTime?
  hrs             Int?
  location        String?   @db.VarChar(500)
  reason          String?   @db.VarChar(500)

  // Relations
  dailyProgress DailyProgress @relation(fields: [dailyProgressId], references: [id], onDelete: Restrict)

  @@index([dailyProgressId])
  @@map("daily_progress_hindrances")
}
model SiteEmployeeLog {
  id           Int      @id @default(autoincrement())
  siteId       Int    
  employeeId   Int     
  assignedDate DateTime
  assignedById   Int
  unassignedDate DateTime?
  unassignedById Int?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  employee    Employee @relation(fields: [employeeId], references: [id], onDelete: Restrict)
  site      Site @relation(fields: [siteId], references: [id], onDelete: Restrict)
  assignedBy User @relation("siteAssignedByLogs", fields: [assignedById], references: [id], onDelete: Restrict)
  unassignedBy User? @relation("siteUnassignedByLogs", fields: [unassignedById], references: [id], onDelete: Restrict)


  @@index([siteId])
  @@index([employeeId])
  @@index([assignedById])
  @@index([unassignedById])
  @@map("site_employee_logs")
}


model SiteEmployee {
  id           Int      @id @default(autoincrement())
  siteId       Int    
  employeeId   Int     
  assignedDate DateTime
  assignedById   Int
  // unassignedDate DateTime?
  // unassignedById Int?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  employee    Employee @relation(fields: [employeeId], references: [id], onDelete: Restrict)
  site      Site @relation(fields: [siteId], references: [id], onDelete: Restrict)
  assignedBy User @relation("siteAssignedBy", fields: [assignedById], references: [id], onDelete: Restrict)
  // unassignedBy User? @relation("siteUnassignedBy", fields: [unassignedById], references: [id], onDelete: Restrict)

  @@index([siteId])
  @@index([employeeId])
  @@index([assignedById])
  // @@index([unassignedById])
  @@map("site_employees")
}

model EmployeeDocument {
  id           Int      @id @default(autoincrement())
  employeeId   Int     
  documentName String
  documentUrl  String       @db.LongText 
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  employee    Employee @relation(fields: [employeeId], references: [id], onDelete: Restrict)

  @@index([employeeId])
  @@map("employee_documents")
}

model ManpowerDocument {
  id           Int      @id @default(autoincrement())
  manpowerId   Int     
  documentName String
  documentUrl  String       @db.LongText 
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  manpower    Manpower @relation(fields: [manpowerId], references: [id], onDelete: Restrict)

  @@index([manpowerId])
  @@map("manpower_documents")
}

model SiteContactPerson {
  id           Int      @id @default(autoincrement())
  siteId       Int     
  name String
  contactNo String?
  email String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  site    Site @relation(fields: [siteId], references: [id], onDelete: Restrict)

  @@index([siteId])
  @@map("site_contact_persons")
}


model SiteDeliveryAddress {
  id           Int      @id @default(autoincrement())
  siteId       Int     
  addressLine1 String?
  addressLine2 String?
  stateId      Int?
  cityId       Int?
  pinCode      String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  site    Site @relation(fields: [siteId], references: [id], onDelete: Restrict)
  state              State?      @relation(fields: [stateId], references: [id])
  city               City?       @relation(fields: [cityId], references: [id])

  purchaseOrders PurchaseOrder[]
  workOrders WorkOrder[]

  @@index([siteId])
  @@index([stateId])
  @@index([cityId])
  @@map("site_delivery_addresses")
}

enum IndentApprovalStatus {
  DRAFT
  APPROVED_LEVEL_1
  APPROVED_LEVEL_2
  COMPLETED
  SUSPENDED
}

enum POApprovalStatus {
  DRAFT
  APPROVED_LEVEL_1
  APPROVED_LEVEL_2
  COMPLETED
  SUSPENDED
}

enum POStatus {
  ORDER_PLACED
  IN_TRANSIT
  RECEIVED
  HOLD
  OPEN
}

enum IndentPriority {
  LOW
  MEDIUM
  HIGH
}
// Indent master data for material requisitions
model Indent {
  id             Int                  @id @default(autoincrement())
  siteId         Int
  site           Site                @relation(fields: [siteId], references: [id], onDelete:Restrict)
  indentNo       String              @unique // auto-generated like IND-00001
  indentDate     DateTime
  deliveryDate   DateTime
  remarks        String?              @db.Text
  // Approval workflow
  priority IndentPriority @default(LOW)
  approvalStatus IndentApprovalStatus @default(DRAFT)
  approved1ById  Int?
  approved1By    User?                @relation("IndentApproved1By", fields: [approved1ById], references: [id])
  approved1At    DateTime?
  approved2ById  Int?
  approved2By    User?                @relation("IndentApproved2By", fields: [approved2ById], references: [id])
  approved2At    DateTime?
 
  completedById  Int?
  completedBy    User?                @relation("IndentCompletedBy", fields: [completedById], references: [id])
  completedAt    DateTime?
  // Suspension (orthogonal to approval)
  suspended      Boolean              @default(false)
  suspendedById  Int?
  suspendedBy    User?                @relation("IndentSuspendedBy", fields: [suspendedById], references: [id])
  suspendedAt    DateTime?
  createdById  Int
  createdAt    DateTime @default(now())
  updatedById  Int
  updatedAt    DateTime @updatedAt

  createdBy User @relation("IndentCreated", fields: [createdById], references: [id], onDelete: Restrict)
  updatedBy User @relation("IndentUpdated", fields: [updatedById], references: [id], onDelete: Restrict)

  // Relations
  indentItems IndentItem[]
  workOrders WorkOrder[]
  purchaseOrderIndent PurchaseOrderIndent[]

  
  @@index([indentNo])
  @@index([siteId])
  @@index([indentDate])
  @@index([priority])
  @@index([approvalStatus])
  @@index([suspended])
  @@index([createdById])
  @@index([updatedById])
  @@map("indents")
}

// Indent line items for detailed material requirements
model IndentItem {
  id           Int      @id @default(autoincrement())
  indentId     Int
  indent       Indent   @relation(fields: [indentId], references: [id], onDelete: Restrict)
  itemId       Int
  item         Item     @relation(fields: [itemId], references: [id], onDelete: Restrict)
  remark       String?  @db.Text
  indentQty    Decimal?  @db.Decimal(12, 2)
  approved1Qty    Decimal?  @db.Decimal(12, 2)
  approved2Qty    Decimal?  @db.Decimal(12, 2)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
indentItemPOs IndentItemPO[]

  @@index([indentId])
  @@index([itemId])
  @@map("indent_items")
}


model PurchaseOrder {
  id                      Int       @id @default(autoincrement())
  siteId                  Int
  site    Site                @relation( fields: [siteId], references: [id], onDelete:Restrict)
  siteDeliveryAddressId                  Int
  siteDeliveryAddress    SiteDeliveryAddress                @relation( fields: [siteDeliveryAddressId], references: [id], onDelete:Restrict)
  paymentTermId           Int?
  paymentTerm    PaymentTerm?                @relation( fields: [paymentTermId], references: [id], onDelete:Restrict)
  billingAddressId        Int
  billingAddress    BillingAddress                @relation( fields: [billingAddressId], references: [id], onDelete:Restrict)
  vendorId                Int
  vendor    Vendor                @relation(fields: [vendorId], references: [id], onDelete:Restrict)
  purchaseOrderNo         String   @db.VarChar(30)  @unique
  purchaseOrderDate       DateTime    @db.Date() 
  quotationNo             String?   @db.VarChar(100)
  quotationDate           DateTime?   @db.Date() 
  deliveryDate            DateTime    @db.Date() 
  transport               String?   @db.VarChar(100)
  note                    String?   @db.Text
  terms                   String?   @db.Text
  paymentTermsInDays      Int?        
  deliverySchedule        String?   @db.Text
  amount                  Decimal?  @db.Decimal(12, 2) 
  pfStatus                String?   @db.VarChar(50)
  pfCharges               String?   @db.VarChar(50)
  totalCgstAmount              Decimal? @db.Decimal(12,2) 
  totalSgstAmount              Decimal? @db.Decimal(12,2) 
  totalIgstAmount              Decimal? @db.Decimal(12,2) 
  gstReverseStatus        String?   @db.VarChar(20)
  gstReverseAmount        String?   @db.VarChar(50)
  exciseTaxStatus         String?   @db.VarChar(20)
  exciseTaxAmount         String?   @db.VarChar(50)
  octroiTaxStatus         String?   @db.VarChar(20)
  octroiTaxAmount         String?   @db.VarChar(50)
  transitInsuranceStatus  String?   @db.VarChar(20)
  transitInsuranceAmount  String?   @db.VarChar(50)
  amountInWords           String?   @db.VarChar(255)
  approvalStatus POApprovalStatus @default(DRAFT)
  poStatus            POStatus    @default(OPEN) 
  isApproved1             Boolean  @default(false)
  approved1ById  Int?
  approved1By    User?                @relation("POApproved1By", fields: [approved1ById], references: [id], onDelete: Restrict)
  approved1At    DateTime?
  isApproved2             Boolean  @default(false)
   approved2ById  Int?
  approved2By    User?                @relation("POApproved2By", fields: [approved2ById], references: [id], onDelete: Restrict)
  approved2At    DateTime?
  billStatus              String?   @db.VarChar(255)
  remarks                 String?   @db.VarChar(255)
  isSuspended             Boolean  @default(false)
   suspendedById  Int?
  suspendedBy    User?                @relation("POSuspendedBy", fields: [suspendedById], references: [id], onDelete: Restrict)
  suspendedAt    DateTime?
  isComplete              Boolean  @default(false)
   completedById  Int?
  completedBy    User?                @relation("POCompletedBy", fields: [completedById], references: [id], onDelete: Restrict)
  completedAt    DateTime?
  createdById  Int
  createdAt    DateTime @default(now())
  updatedById  Int
  updatedAt    DateTime @updatedAt
  revision                Int?
  createdBy User @relation("POCreated", fields: [createdById], references: [id], onDelete: Restrict)
  updatedBy User @relation("POUpdated", fields: [updatedById], references: [id], onDelete: Restrict)

  purchaseOrderDetails PurchaseOrderDetail[] 
  inwardDeliveryChallan InwardDeliveryChallan[]
  poPaymentTerms POPaymentTerm[]
  purchaseOrderIndent PurchaseOrderIndent[]
    poAdditionalCharge  PoAdditionalCharge[]


@@index([siteId])
@@index([vendorId])
@@index([billingAddressId])
@@index([paymentTermId])
@@index([createdById])
@@index([updatedById])
@@index([approved1ById])
@@index([approved2ById])
@@index([suspendedById])
@@index([completedById])

  @@map("purchase_orders")
}


model PurchaseOrderDetail {
  id              Int       @id @default(autoincrement())
  serialNo        Int
  purchaseOrderId Int
  purchaseOrder PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Restrict)

  itemId          Int
  item            Item @relation(fields: [itemId], references: [id], onDelete: Restrict)
  remark          String?   @db.VarChar(500)
  qty             Decimal?  @db.Decimal(12, 2)
  orderedQty      Decimal?  @db.Decimal(12, 2)
  approved1Qty    Decimal?  @db.Decimal(12, 2)
  approved2Qty    Decimal?  @db.Decimal(12, 2)
  receivedQty     Decimal?  @default("0.00") @db.Decimal(12, 2)
  rate            Decimal?  @db.Decimal(12, 2)
  discountPercent        Decimal?  @default(0.00) @db.Decimal(10, 2)
  disAmt          Decimal?  @db.Decimal(10, 2)
  tax             Decimal?  @db.Decimal(10, 2)
  taxAmt          Decimal?  @db.Decimal(10, 2)
  cgstPercent            Decimal?  @db.Decimal(10, 2)
  cgstAmt         Decimal?  @db.Decimal(10, 2)
  sgstPercent            Decimal?  @db.Decimal(10, 2)
  sgstAmt         Decimal?  @db.Decimal(10, 2)
  igstPercent            Decimal?  @db.Decimal(10, 2)
  igstAmt         Decimal?  @db.Decimal(10, 2)
  amount          Decimal?  @db.Decimal(10, 2)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Relations
  InwardDeliveryChallanDetail InwardDeliveryChallanDetail[]
  indentItemPOs IndentItemPO[]

@@index([purchaseOrderId])
@@index([itemId])

  @@map("purchase_order_details")
}

model PoAdditionalCharge {
  id              Int       @id @default(autoincrement())
  purchaseOrderId Int
  purchaseOrder PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Restrict)
  head      String  
  gstCharge   String
  amount     Decimal?  @db.Decimal(12, 2)
  amountWithGst     Decimal?  @db.Decimal(12, 2)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([purchaseOrderId])
  @@map("po_additional_charges")
}

model PurchaseOrderIndent {
  id             Int @id @default(autoincrement())
  purchaseOrderId Int
  indentId        Int

  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Restrict)
  indent          Indent        @relation(fields: [indentId], references: [id], onDelete: Restrict)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  @@unique([purchaseOrderId, indentId])
  @@index([indentId])
  @@index([purchaseOrderId])
  @@map("purchase_order_indents")
}

model IndentItemPO {
  id                    Int      @id @default(autoincrement())
  indentItemId          Int
  purchaseOrderDetailId Int
  orderedQty            Decimal  @db.Decimal(12, 2)

  indentItem            IndentItem          @relation(fields: [indentItemId], references: [id], onDelete: Restrict)
  purchaseOrderDetail   PurchaseOrderDetail @relation(fields: [purchaseOrderDetailId], references: [id], onDelete: Restrict)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  @@unique([indentItemId, purchaseOrderDetailId])
  @@index([indentItemId])
  @@index([purchaseOrderDetailId])
  @@map("indent_item_pos")
}

model RentDocument {
  id           Int      @id @default(autoincrement())
  rentId   Int     
  documentName String
  documentUrl  String       @db.LongText 
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  rent    Rent @relation(fields: [rentId], references: [id], onDelete: Restrict)

  @@index([rentId])
  @@map("rent_documents")
}

model AssetDocument {
  id           Int      @id @default(autoincrement())
  assetId   Int     
  documentName String
  documentUrl  String       @db.LongText 
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  asset    Asset @relation(fields: [assetId], references: [id], onDelete: Restrict)

  @@index([assetId])
  @@map("asset_documents")
}

model CompanyDocument {
  id           Int      @id @default(autoincrement())
  companyId   Int     
  documentName String
  documentUrl  String       @db.LongText 
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  company    Company @relation(fields: [companyId], references: [id], onDelete: Restrict)

  @@index([companyId])
  @@map("company_documents")
}

model AssetTransferDocument {
  id           Int      @id @default(autoincrement())
  assetTransferId   Int     
  documentName String
  documentUrl  String       @db.LongText 
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  assetTransfer    AssetTransfer @relation(fields: [assetTransferId], references: [id], onDelete: Restrict)

  @@index([assetTransferId])
  @@map("asset_transfer_documents")
}


model NoticeDocument {
  id           Int      @id @default(autoincrement())
  noticeId   Int     
  documentName String
  documentUrl  String       @db.LongText 
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  notice    Notice @relation(fields: [noticeId], references: [id], onDelete: Restrict)

  @@index([noticeId])
  @@map("notice_documents")
}

enum WorkOrderType {
  SUB_CONTRACT
  PWR_WORK
}

model WorkOrder {
  id                      Int       @id @default(autoincrement())
  type         WorkOrderType  
  indentId                Int?
  indent    Indent?                @relation( fields: [indentId], references: [id], onDelete:Restrict)
  siteId                  Int
  site    Site                @relation( fields: [siteId], references: [id], onDelete:Restrict)
  siteDeliveryAddressId                  Int
  siteDeliveryAddress    SiteDeliveryAddress                @relation( fields: [siteDeliveryAddressId], references: [id], onDelete:Restrict)
  paymentTermId           Int?
  paymentTerm    PaymentTerm?                @relation( fields: [paymentTermId], references: [id], onDelete:Restrict)
  billingAddressId        Int
  billingAddress    BillingAddress                @relation( fields: [billingAddressId], references: [id], onDelete:Restrict)
  vendorId                Int
  vendor    Vendor                @relation(fields: [vendorId], references: [id], onDelete:Restrict)
  workOrderNo         String   @db.VarChar(30)  @unique
  workOrderDate       DateTime 
  quotationNo             String   @db.VarChar(100)
  quotationDate           DateTime 
  deliveryDate            DateTime 
  transport               String?   @db.VarChar(100)
  note                    String?   @db.Text
  terms                   String?   @db.Text
  paymentTermsInDays      Int?        
  deliverySchedule        String?   @db.Text
  amount                  Decimal?  @db.Decimal(12, 2) 
  pfStatus                String?   @db.VarChar(50)
  pfCharges               String?   @db.VarChar(50)
  totalCgstAmount              Decimal? @db.Decimal(12,2) 
  totalSgstAmount              Decimal? @db.Decimal(12,2) 
  totalIgstAmount              Decimal? @db.Decimal(12,2) 
  gstReverseStatus        String?   @db.VarChar(20)
  gstReverseAmount        String?   @db.VarChar(50)
  exciseTaxStatus         String?   @db.VarChar(20)
  exciseTaxAmount         String?   @db.VarChar(50)
  octroiTaxStatus         String?   @db.VarChar(20)
  octroiTaxAmount         String?   @db.VarChar(50)
  transitInsuranceStatus  String?   @db.VarChar(20)
  transitInsuranceAmount  String?   @db.VarChar(50)
  amountInWords           String?   @db.VarChar(255)
  approvalStatus IndentApprovalStatus @default(DRAFT)
  woStatus                   String?  //HOLD OR NULL
  isApproved1             Boolean  @default(false)
  approved1ById  Int?
  approved1By    User?                @relation("WOApproved1By", fields: [approved1ById], references: [id], onDelete: Restrict)
  approved1At    DateTime?
  isApproved2             Boolean  @default(false)
   approved2ById  Int?
  approved2By    User?                @relation("WOApproved2By", fields: [approved2ById], references: [id], onDelete: Restrict)
  approved2At    DateTime?
  billStatus              String?   @db.VarChar(255)
  remarks                 String?   @db.VarChar(255)
  isSuspended             Boolean  @default(false)
   suspendedById  Int?
  suspendedBy    User?                @relation("WOSuspendedBy", fields: [suspendedById], references: [id], onDelete: Restrict)
  suspendedAt    DateTime?
  isComplete              Boolean  @default(false)
   completedById  Int?
  completedBy    User?                @relation("WOCompletedBy", fields: [completedById], references: [id], onDelete: Restrict)
  completedAt    DateTime?
  createdById  Int
  createdAt    DateTime @default(now())
  updatedById  Int
  updatedAt    DateTime @updatedAt
  revision                Int?
  createdBy User @relation("WOCreated", fields: [createdById], references: [id], onDelete: Restrict)
  updatedBy User @relation("WOUpdated", fields: [updatedById], references: [id], onDelete: Restrict)

  workOrderDetails WorkOrderDetail[] 
  workOrderBills WorkOrderBill[]
@@index([siteId])
@@index([indentId])
@@index([vendorId])
@@index([billingAddressId])
@@index([paymentTermId])
@@index([createdById])
@@index([updatedById])
@@index([approved1ById])
@@index([approved2ById])
@@index([suspendedById])
@@index([completedById])

  @@map("work_orders")
}


model WorkOrderDetail {
  id              Int       @id @default(autoincrement())
  serialNo        Int
  workOrderId Int
  workOrder WorkOrder @relation(fields: [workOrderId], references: [id], onDelete: Restrict)
  itemId          Int
  item            Item @relation(fields: [itemId], references: [id], onDelete: Restrict)
  sac_code        String  
  remark          String?   @db.VarChar(500)
  qty             Decimal?  @db.Decimal(12, 2)
  orderedQty      Decimal?  @db.Decimal(12, 2)
  approved1Qty    Decimal?  @db.Decimal(12, 2)
  approved2Qty    Decimal?  @db.Decimal(12, 2)
  receivedQty     Decimal?  @default("0.00") @db.Decimal(12, 2)
  rate            Decimal?  @db.Decimal(12, 2)
  cgstPercent            Decimal?  @db.Decimal(10, 2)
  cgstAmt         Decimal?  @db.Decimal(10, 2)
  sgstPercent            Decimal?  @db.Decimal(10, 2)
  sgstAmt         Decimal?  @db.Decimal(10, 2)
  igstPercent            Decimal?  @db.Decimal(10, 2)
  igstAmt         Decimal?  @db.Decimal(10, 2)
  amount          Decimal?  @db.Decimal(10, 2)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt


@@index([workOrderId])

  @@map("work_order_details")
}


enum WorkOrderBillStatus {
  PAID
  UNPAID
  PARTIALLY_PAID
}

model WorkOrderBill {
  id              Int      @id @default(autoincrement())
  workOrderId Int
  workOrder WorkOrder @relation(fields: [workOrderId], references: [id], onDelete: Restrict)
  billNo          String  @db.VarChar(50) 
  billDate        DateTime  
  billAmount      Decimal   @default(0.00) @db.Decimal(10, 2)
  paidAmount      Decimal   @default(0.00) @db.Decimal(10, 2) 
  dueDate         DateTime   
  paymentDate     DateTime  
  paymentMode     String   @db.VarChar(50)
  chequeNo        String?   @db.VarChar(200) 
  chequeDate      DateTime?  
  utrNo           String?   @db.VarChar(200) 
  bankName        String?   @db.VarChar(100) 
  deductionTax    Decimal   @default(0.00) @db.Decimal(10, 2) 
  dueAmount    Decimal   @default(0.00) @db.Decimal(10, 2) 
  status         WorkOrderBillStatus 

 createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  @@index([workOrderId])

  @@map("work_order_bills")
}

enum InwardDeliveryChallanStatus {
  PAID
  UNPAID
  PARTIALLY_PAID
}

model InwardDeliveryChallan {
  id               Int       @id @default(autoincrement())
  purchaseOrderId Int   
  purchaseOrder PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Restrict)
  vendorId         Int
  vendor Vendor @relation(fields: [vendorId], references: [id], onDelete: Restrict)
  siteId           Int
  site Site @relation(fields: [siteId], references: [id], onDelete: Restrict)
  inwardChallanNo  String  @unique 
  inwardChallanDate DateTime
  challanNo        String   @db.VarChar(100)
  challanDate      DateTime

  lrNo             String?   @db.VarChar(100)
  lRDate           DateTime?
  invoiceNo        String?   @db.VarChar(100)
  invoiceDate      DateTime?
  billNo           String?   @db.VarChar(100)
  billDate         DateTime?
  vehicleNo        String?   @db.VarChar(50)
  remarks          String?   @db.VarChar(255)
  billAmount       Decimal  @default(0.00) @db.Decimal(12, 2)
  dueDays          Int      @default(0)
  dueDate          DateTime?
  status           InwardDeliveryChallanStatus @default(UNPAID)
  dueAmount    Decimal  @default(0.00) @db.Decimal(12, 2)
  totalPaidAmount  Decimal  @default(0.00) @db.Decimal(12, 2)
  createdById  Int
  createdAt    DateTime @default(now())
  updatedById  Int
  updatedAt    DateTime @updatedAt
  createdBy User @relation("IDCCreated", fields: [createdById], references: [id], onDelete: Restrict)
  updatedBy User @relation("IDCUpdated", fields: [updatedById], references: [id], onDelete: Restrict)


//relations
  inwardDeliveryChallanDetails InwardDeliveryChallanDetail[]
  inwardDeliveryChallanDocuments InwardDeliveryChallanDocuments[]
  stockLedgers StockLedger[]
  inwardBillDetail  InwardBillDetail[]
  @@index([purchaseOrderId])
  @@index([vendorId])
  @@index([siteId])
  @@index([createdById])
  @@index([updatedById])
  @@map("inward_delivery_challans")
}

model InwardDeliveryChallanDetail {
  id                        Int      @id @default(autoincrement())
  inwardDeliveryChallanId   Int   
  poDetailsId               Int   
  receivingQty              Decimal  @db.Decimal(12, 2) @default(0.00)
  rate                      Decimal @db.Decimal(12, 2) @default(0.00)
  amount                    Decimal @db.Decimal(12, 2) @default(0.00)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  idcDetailBatches   InwardDeliveryChallanDetailBatch[]
  inwardDeliveryChallan InwardDeliveryChallan @relation(fields: [inwardDeliveryChallanId], references: [id], onDelete: Restrict)
  poDetails PurchaseOrderDetail @relation(fields: [poDetailsId], references: [id], onDelete: Restrict)  
  @@index([inwardDeliveryChallanId])
  @@index([poDetailsId])
  @@map("inward_delivery_challan_details")
}

model InwardDeliveryChallanDetailBatch {
  id           Int       @id @default(autoincrement())
  inwardDeliveryChallanDetailId   Int
  batchNumber      String    
  expiryDate   String 
  qty          Decimal   @default(0.00)   @db.Decimal(12, 2)
  unitRate     Decimal   @default(0.00)   @db.Decimal(12, 2)
  amount Decimal   @default(0.00)   @db.Decimal(12, 2)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  inwardDeliveryChallanDetail  InwardDeliveryChallanDetail  @relation(fields: [inwardDeliveryChallanDetailId], references: [id], onDelete: Restrict)
  
 @@index([inwardDeliveryChallanDetailId])
  @@map("inward_delivery_challan_detail_batches")
}


model InwardDeliveryChallanDocuments {
  id           Int      @id @default(autoincrement())
  inwardDeliveryChallanId   Int     
  documentName String
  documentUrl  String       @db.LongText 
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  inwardDeliveryChallan    InwardDeliveryChallan @relation(fields: [inwardDeliveryChallanId], references: [id], onDelete: Restrict)

  @@index([inwardDeliveryChallanId])
  @@map("inward_delivery_challan_documents")
}


model StockLedger {
  id             Int       @id @default(autoincrement())
  siteId                  Int

  transactionDate DateTime
  itemId          Int
  inwardDeliveryChallanId   Int?   
  outwardDeliveryChallanId   Int?   
  dailyConsumptionId   Int?   
  stockAdjustmentId      Int?

  receivedQty     Decimal  @db.Decimal(12,2) @default(0.00)
  issuedQty     Decimal  @db.Decimal(12, 2) @default(0.00)
  unitRate     Decimal  @db.Decimal(12, 2) @default(0.00)
  documentType   String
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  site    Site                @relation( fields: [siteId], references: [id], onDelete:Restrict)
  item            Item @relation(fields: [itemId], references: [id], onDelete: Restrict)
  inwardDeliveryChallan InwardDeliveryChallan? @relation(fields: [inwardDeliveryChallanId], references: [id], onDelete: Restrict)
  outwardDeliveryChallan OutwardDeliveryChallan? @relation(fields: [outwardDeliveryChallanId], references: [id], onDelete: Restrict)
  dailyConsumption DailyConsumption? @relation(fields: [dailyConsumptionId], references: [id], onDelete: Restrict)
  stockAdjustment StockAdjustment? @relation(fields: [stockAdjustmentId], references: [id], onDelete: Restrict)

  @@index([siteId])
  @@index([itemId])
  @@index([inwardDeliveryChallanId])
  @@index([outwardDeliveryChallanId])

  @@map("stock_ledgers")
}


model SiteItem {
  id            Int       @id @default(autoincrement())
  siteId                  Int
  itemId          Int
  openingStock  Decimal    @default(0.00)   @db.Decimal(12,2) 
  openingRate   Decimal    @default(0.00)   @db.Decimal(12,2) 
  openingValue  Decimal    @default(0.00)   @db.Decimal(12,2) 
  closingStock  Decimal    @default(0.00)    @db.Decimal(12,2) 
  closingValue  Decimal    @default(0.00)    @db.Decimal(12,2) 
  unitRate      Decimal    @default(0.00)   @db.Decimal(12,2) 
  reorderLevel  Decimal    @default(0.00)    @db.Decimal(12,2)
  log           String?    @db.VarChar(50)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  site        Site    @relation( fields: [siteId], references: [id], onDelete:Restrict)
  item        Item    @relation(fields: [itemId], references: [id], onDelete:Restrict)
  siteItemBatches  SiteItemBatch[]
    @@index([siteId])
  @@index([itemId])

  @@map("site_items")
}

model SiteItemBatch {
  id           Int       @id @default(autoincrement())
  siteItemId   Int
  siteId        Int
  itemId        Int

  batchNumber      String    
  expiryDate   String  
  batchOpeningRate     Decimal   @default(0.00)   @db.Decimal(12, 2)
  openingQty   Decimal   @default(0.00) @db.Decimal(12, 2)
  unitRate     Decimal   @default(0.00)   @db.Decimal(12, 2)
  openingValue Decimal   @default(0.00)   @db.Decimal(12, 2)
  closingQty   Decimal   @default(0.00) @db.Decimal(12, 2)
  closingValue Decimal   @default(0.00)   @db.Decimal(12, 2)

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  // fix this
  siteItem     SiteItem  @relation(fields: [siteItemId], references: [id], onDelete: Restrict)
  site     Site  @relation(fields: [siteId], references: [id], onDelete: Restrict)
  item     Item  @relation(fields: [itemId], references: [id], onDelete: Restrict)

  @@unique([siteItemId, batchNumber], name: "uq_siteitem_batch")
  @@map("site_item_batches")
}



model OutwardDeliveryChallan {
  id                 Int       @id @default(autoincrement())
  outwardChallanNo   String   @unique
  outwardChallanDate DateTime
  challanNo          String   @db.VarChar(100)
  challanDate        DateTime
  fromSiteId         Int
  toSiteId           Int

  isApproved1             Boolean  @default(false)
  approved1ById  Int?
  approved1By    User?                @relation("ODCApproved1By", fields: [approved1ById], references: [id], onDelete: Restrict)
  approved1At    DateTime?
  isAccepted             Boolean  @default(false)
  acceptedById  Int?
  acceptedBy    User?                @relation("ODCAcceptedBy", fields: [acceptedById], references: [id], onDelete: Restrict)

  acceptedAt    DateTime?
 createdById  Int
  createdAt    DateTime @default(now())
  updatedById  Int
  updatedAt    DateTime @updatedAt
  createdBy User @relation("ODCCreated", fields: [createdById], references: [id], onDelete: Restrict)
  updatedBy User @relation("ODCUpdated", fields: [updatedById], references: [id], onDelete: Restrict)

  fromSite Site @relation("ODCFromSite", fields: [fromSiteId], references: [id], onDelete: Restrict)
  toSite Site @relation("ODCToSite", fields: [toSiteId], references: [id], onDelete: Restrict)

  // 
  stockLedgers  StockLedger[]
  @@index([fromSiteId])
  @@index([toSiteId])
  @@index([approved1ById])
  @@index([acceptedById])
  @@index([createdById])
  @@index([updatedById])

  outwardDeliveryChallanDetails OutwardDeliveryChallanDetail[]
  outwardDeliveryChallanDocuments OutwardDeliveryChallanDocuments[]

  @@map("outward_delivery_challans")
}


enum InwardBillPaymentMode {
  CASH 
  UPI 
  CHEQUE 
  RTGS 
  NEFT 
  NET_BANKING 
}

model OutwardDeliveryChallanDetail {
  id                         Int      @id @default(autoincrement())
  outwardDeliveryChallanId   Int
  itemId                     Int
  qty                        Decimal  @default(0.00)   @db.Decimal(12,2) 
  challanQty                 Decimal @default(0.00)   @db.Decimal(12,2) 
  approved1Qty               Decimal @default(0.00)   @db.Decimal(12,2) 
  receivedQty                Decimal @default(0.00)   @db.Decimal(12,2) 
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  // relation (many details belong to one challan)
  outwardDeliveryChallan OutwardDeliveryChallan @relation(fields: [outwardDeliveryChallanId], references: [id],onDelete: Restrict)
  item Item @relation(fields: [itemId], references: [id], onDelete: Restrict)
  outwardDeliveryChallanDetailBatch OutwardDeliveryChallanDetailBatch[]
  @@index([outwardDeliveryChallanId])
  @@index([itemId])

  @@map("outward_delivery_challan_details")
}


model OutwardDeliveryChallanDocuments {
  id           Int      @id @default(autoincrement())
  outwardDeliveryChallanId   Int     
  documentName String
  documentUrl  String       @db.LongText 
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  outwardDeliveryChallan    OutwardDeliveryChallan @relation(fields: [outwardDeliveryChallanId], references: [id], onDelete: Restrict)

  @@index([outwardDeliveryChallanId])
  @@map("outward_delivery_challan_documents")
}

model OutwardDeliveryChallanDetailBatch {
  id           Int       @id @default(autoincrement())
  outwardDeliveryChallanDetailId   Int
  batchNumber      String    
  expiryDate   String 
  qty          Decimal   @default(0.00)   @db.Decimal(12, 2)
  unitRate     Decimal   @default(0.00)   @db.Decimal(12, 2)
  amount Decimal   @default(0.00)   @db.Decimal(12, 2)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  outwardDeliveryChallanDetail  OutwardDeliveryChallanDetail  @relation(fields: [outwardDeliveryChallanDetailId], references: [id], onDelete: Restrict)
  
  @@index([outwardDeliveryChallanDetailId])
  @@map("outward_delivery_challan_detail_batches")
}



model InwardBillDetail {
  id                        Int       @id @default(autoincrement())
  inwardDeliveryChallanId   Int
  paymentDate               DateTime
  paymentMode               InwardBillPaymentMode
  chequeNo                  String?   @db.VarChar(30)
  chequeDate                DateTime?
  utrNo                     String?   @db.VarChar(50)
  rtgsDate                  DateTime?
  neftDate                  DateTime?
  transactionNo             String?   @db.VarChar(30)
  transactionDate           DateTime?
  bankName                  String?   @db.VarChar(50)
  paidAmount                Decimal    @default(0.00) @db.Decimal(12, 2)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  inwardDeliveryChallan    InwardDeliveryChallan @relation(fields: [inwardDeliveryChallanId], references: [id], onDelete: Restrict)

  @@index([inwardDeliveryChallanId])
  @@map("inward_bill_details")
}

model DailyConsumption {
  id             Int       @id @default(autoincrement())
  dailyConsumptionNo  String @unique  
  dailyConsumptionDate DateTime
  siteId         Int  
  totalAmount    Decimal    @default(0.00) @db.Decimal(12, 2)

  createdById  Int
  createdAt    DateTime @default(now())
  updatedById  Int
  updatedAt    DateTime @updatedAt
  createdBy User @relation("ConsumptionCreated", fields: [createdById], references: [id], onDelete: Restrict)
  updatedBy User @relation("ConsumptionUpdated", fields: [updatedById], references: [id], onDelete: Restrict)

  site Site @relation(fields: [siteId], references: [id], onDelete: Restrict)

  dailyConsumptionDetails DailyConsumptionDetail[]
  stockLedgers             StockLedger[]
  @@index([siteId])
  @@index([createdById])
  @@index([updatedById])

  @@map("daily_consumptions")
}

model DailyConsumptionDetail {
  id            Int      @id @default(autoincrement())
  dailyConsumptionId Int   
  itemId        Int   
  qty           Decimal? @db.Decimal(12, 2)
  rate          Decimal? @db.Decimal(12, 2)
  amount        Decimal? @db.Decimal(12, 2)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  // Relations
  dailyConsumption   DailyConsumption @relation(fields: [dailyConsumptionId], references: [id], onDelete: Restrict)
  item          Item       @relation(fields: [itemId], references: [id], onDelete: Restrict)
  dailyConsumptionDetailBatch DailyConsumptionDetailBatch[]

  @@index([dailyConsumptionId])
  @@index([itemId])
  @@map("daily_consumption_details")
}

model DailyConsumptionDetailBatch {
  id           Int       @id @default(autoincrement())
  dailyConsumptionDetailId   Int
  batchNumber      String    
  expiryDate   String 
  qty          Decimal   @default(0.00)   @db.Decimal(12, 2)
  unitRate     Decimal   @default(0.00)   @db.Decimal(12, 2)
  amount Decimal   @default(0.00)   @db.Decimal(12, 2)
  
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  
  dailyConsumptionDetail  DailyConsumptionDetail  @relation(fields: [dailyConsumptionDetailId], references: [id], onDelete: Restrict)
  
  @@index([dailyConsumptionDetailId])
  @@map("daily_consumption_detail_batches")
}


model StockAdjustment {
  id         Int      @id @default(autoincrement())
  date       DateTime
  siteId     Int      
  createdById  Int
  createdAt    DateTime @default(now())
  updatedById  Int
  updatedAt    DateTime @updatedAt
  createdBy User @relation("SACreated", fields: [createdById], references: [id], onDelete: Restrict)
  updatedBy User @relation("SAUpdated", fields: [updatedById], references: [id], onDelete: Restrict)

  site Site @relation(fields: [siteId], references: [id], onDelete: Restrict)

 stockAdjustmentDetail   StockAdjustmentDetail[]
 stockLedgers      StockLedger[]
 @@index([siteId])
 @@index([createdById])
 @@index([updatedById])

  @@map("stock_adjustments")
}


model StockAdjustmentDetail {
  id                Int       @id @default(autoincrement())
  stockAdjustmentId Int  
  itemId            Int  
  issuedQty         Decimal  @default(0.0000) @db.Decimal(12, 2)
  receivedQty       Decimal  @default(0.0000) @db.Decimal(12, 2) 
  rate              Decimal  @default(0.00) @db.Decimal(12, 2)
  amount            Decimal  @default(0.00) @db.Decimal(12, 2)
  remarks           String?
createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  stockAdjustment StockAdjustment @relation(fields: [stockAdjustmentId], references: [id], onDelete: Restrict)
  item Item                       @relation(fields: [itemId], references: [id], onDelete: Restrict)

   @@index([itemId])
   @@index([stockAdjustmentId])
  @@map("stock_adjustment_details")
}




model BOQBill {
  id                Int       @id @default(autoincrement())
  boqId Int  
  billNumber       String  @unique
  billName         String
  billDate        DateTime @db.Date()
  remarks   String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  createdById  Int
  updatedById  Int
  boq       Boq      @relation(fields: [boqId], references: [id], onDelete:Restrict)
  totalBillAmount Decimal @default(0.00) @db.Decimal(12, 2)
  boqBillDetails BOQBillDetail[]

   
  createdBy User @relation("BOQBillCreated", fields: [createdById], references: [id], onDelete: Restrict)
  updatedBy User @relation("BOQBillUpdated", fields: [updatedById], references: [id], onDelete: Restrict)

  @@index([boqId])
  @@index([createdById])
  @@index([updatedById])

  @@map("boq_bills")
}


model BOQBillDetail {
  id                Int       @id @default(autoincrement())
  boqBillId Int  
  boqItemId Int
  qty         Decimal  @default(0.0000) @db.Decimal(12, 2)
  amount              Decimal  @default(0.00) @db.Decimal(12, 2)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  boqBill   BOQBill @relation(fields: [boqBillId], references: [id], onDelete: Restrict)
  boqItem BoqItem                    @relation(fields: [boqItemId], references: [id], onDelete: Restrict)

   @@index([boqItemId])
   @@index([boqBillId])
  @@map("boq_bill_details")
}


model Zone {
  id        Int      @id @default(autoincrement())
  zoneName     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

sites     Site[]

  @@index([id])
  @@map("zones")
}


// Site Budget - manages budget items for each site
model SiteBudget {
  id             Int      @id @default(autoincrement())
  siteId         Int
  site           Site     @relation(fields: [siteId], references: [id], onDelete: Restrict)
  boqId          Int
  boq            Boq      @relation(fields: [boqId], references: [id], onDelete: Restrict)
  month          String
  week           String
  fromDate DateTime  @db.Date()
  toDate   DateTime   @db.Date()
  createdById      Int
  updatedById      Int
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  siteBudgetDetails  SiteBudgetDetail[]

  createdBy User @relation("SiteBudgetCreated", fields: [createdById], references: [id], onDelete: Restrict)
  updatedBy User @relation("SiteBudgetUpdated", fields: [updatedById], references: [id], onDelete: Restrict)

 @@index([createdById])
  @@index([updatedById])
  @@index([siteId])
  @@index([boqId])
  @@index([fromDate])
 @@index([toDate])
 @@index([month])
 @@index([week])
  @@unique([siteId, boqId, month, week])

  @@map("site_budgets")
}

model SiteBudgetDetail {
  id             Int      @id @default(autoincrement())
  SiteBudgetId          Int
  siteBudget            SiteBudget      @relation(fields: [SiteBudgetId], references: [id], onDelete: Restrict)
  BoqItemId     Int 
  boqItem            BoqItem      @relation(fields: [BoqItemId], references: [id], onDelete: Restrict)

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  siteBudgetItems  SiteBudgetItem[]

  @@index([SiteBudgetId])
  @@index([BoqItemId])
  
  @@map("site_budget_details")
}

model SiteBudgetItem {
  id             Int      @id @default(autoincrement())
  SiteBudgetDetailId          Int
  siteBudgetDetail            SiteBudgetDetail      @relation(fields: [SiteBudgetDetailId], references: [id], onDelete: Restrict)
  itemId     Int 
  item            Item      @relation(fields: [itemId], references: [id], onDelete: Restrict)
  budgetQty    Decimal? @db.Decimal(12, 2)
  budgetRate   Decimal? @db.Decimal(12, 2)
  purchaseRate Decimal? @db.Decimal(12, 2)
  budgetValue  Decimal? @db.Decimal(12, 2) // Calculated: budgetQty * budgetRate
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@index([SiteBudgetDetailId])
  @@index([itemId])
  
  @@map("site_budget_items")
}

